<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="{{ url_for('static',filename='js/modal.js')}}" defer></script>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>üîß –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π</p>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-number">{{ users|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr("role", "equalto", "manager")|list|length }}</div>
                <div class="stat-label">–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ users|selectattr("is_active")|list|length }}</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
        </div>

        <!-- –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
        <div class="admin-section">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <form action="{{ url_for('create_manager') }}" method="POST" class="admin-form">
                <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <select name="role" style="background: #1a1a1a; color: #fff; border: 2px solid #444; padding: 12px 15px; border-radius: 8px;">
                    <option value="client">üë§ –ö–ª–∏–µ–Ω—Ç</option>
                    <option value="manager">üëî –ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                    <option value="admin">üëë –ê–¥–º–∏–Ω</option>
                </select>
                <button type="submit" class="admin-btn">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="admin-section">
            <h2>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <table class="admin-table">
                <tr>
                    <th>ID</th>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–†–æ–ª—å</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°–æ–∑–¥–∞–Ω</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>
                        <div class="role-dropdown {% if user.username != 'admin' %}has-arrow{% endif %}">
                            {% if user.role == 'admin' %}
                                {% if user.username == 'admin' %}
                                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω - –±–µ–∑ –º–µ–Ω—é –∏ —Å—Ç—Ä–µ–ª–æ—á–∫–∏ -->
                                <button class="role-btn admin" disabled>üëë –ê–¥–º–∏–Ω</button>
                                <small style="display: block; color: #CAFF33; font-size: 10px;">–û—Å–Ω–æ–≤–Ω–æ–π</small>
                                {% else %}
                                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∞–¥–º–∏–Ω—ã - —Å –º–µ–Ω—é -->
                                <button class="role-btn admin" onclick="toggleRoleMenu(this)">üëë –ê–¥–º–∏–Ω</button>
                                {% endif %}
                            {% elif user.role == 'manager' %}
                            <button class="role-btn manager" onclick="toggleRoleMenu(this)">üëî –ú–µ–Ω–µ–¥–∂–µ—Ä</button>
                            {% else %}
                            <button class="role-btn client" onclick="toggleRoleMenu(this)">üë§ –ö–ª–∏–µ–Ω—Ç</button>
                            {% endif %}
                            
                            {% if user.username != 'admin' %}
                            <div class="role-dropdown-content" id="role-menu-{{ user.id }}">
                                <form action="{{ url_for('change_role') }}" method="POST">
                                    <input type="hidden" name="user_id" value="{{ user.id }}">
                                    <button type="submit" name="new_role" value="client" class="role-option {% if user.role == 'client' %}active{% endif %}">
                                        üë§ –ö–ª–∏–µ–Ω—Ç
                                    </button>
                                    <button type="submit" name="new_role" value="manager" class="role-option {% if user.role == 'manager' %}active{% endif %}">
                                        üëî –ú–µ–Ω–µ–¥–∂–µ—Ä
                                    </button>
                                    <button type="submit" name="new_role" value="admin" class="role-option admin-option {% if user.role == 'admin' %}active{% endif %}">
                                        üëë –ê–¥–º–∏–Ω
                                    </button>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        {% if user.is_active %}
                        <span class="status-active">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                        <span class="status-inactive">‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                        {% endif %}
                    </td>
                    <td>{{ user.created_by or '–°–∏—Å—Ç–µ–º–∞' }}</td>
                    <td>
                        {% if user.role != 'admin' or user.username != 'admin' %}
                        <form action="{{ url_for('toggle_user') }}" method="POST" style="display:inline;">
                            <input type="hidden" name="user_id" value="{{ user.id }}">
                            <button type="submit" class="admin-btn secondary" {% if user.username == 'admin' %}disabled{% endif %}>
                                {% if user.is_active %}–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å{% else %}–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å{% endif %}
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <a href="{{ url_for('index') }}" class="admin-back">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</body>
</html>